{% extends "base.html" %}
{% block title %}Produtos{% endblock %}
{% block content %}
<h2 class="mb-4 text-primary">Estoque de Roupas</h2>

<form method="get" class="row g-3 mb-4">
  <div class="col-md-3">
    <input type="text" name="nome" class="form-control" placeholder="Buscar por nome" value="{{ nome }}">
  </div>
  <div class="col-md-3">
    <input type="text" name="categoria" class="form-control" placeholder="Filtrar por categoria" value="{{ categoria }}">
  </div>
  <div class="col-md-2">
    <input type="text" name="tamanho" class="form-control" placeholder="Filtrar por tamanho" value="{{ tamanho }}">
  </div>
  <div class="col-md-2">
    <select name="ordenar" class="form-select">
      <option value="nome" {% if ordenar == 'nome' %}selected{% endif %}>Nome</option>
      <option value="preco" {% if ordenar == 'preco' %}selected{% endif %}>PreÃ§o</option>
      <option value="quantidade" {% if ordenar == 'quantidade' %}selected{% endif %}>Quantidade</option>
    </select>
  </div>
  <div class="col-md-2">
    <select name="ordem" class="form-select">
      <option value="asc" {% if ordem == 'asc' %}selected{% endif %}>Crescente</option>
      <option value="desc" {% if ordem == 'desc' %}selected{% endif %}>Decrescente</option>
    </select>
  </div>
  <div class="col-12 d-grid">
    <button type="submit" class="btn btn-primary">ðŸ”Ž Filtrar & Ordenar</button>
  </div>
</form>

{% if produtos %}
  <div class="row">
    {% for p in produtos %}
    <div class="col-md-4 mb-4">
      <div class="card shadow h-100">
        {% if p.imagem %}
          <img src="{{ url_for('static', filename='uploads/' ~ p.imagem) }}" class="card-img-top" alt="{{ p.nome }}">
        {% else %}
          <img src="https://via.placeholder.com/300x200?text=Sem+Imagem" class="card-img-top" alt="sem imagem">
        {% endif %}
        <div class="card-body">
          <h5 class="card-title">
            <a href="{{ url_for('produto', indice=loop.index0) }}">{{ p.nome }}</a>
          </h5>
          <p class="card-text small">
            Categoria: {{ p.categoria }} Â· Tamanho: {{ p.tamanho }} Â· Qtde: {{ p.quantidade }}
          </p>
          <p class="card-text">
            <strong>Venda:</strong> R$ {{ "%.2f"|format(p.preco_venda) }}
          </p>
        </div>
        <div class="card-footer text-center">
          <a href="{{ url_for('remover', indice=loop.index0) }}" class="btn btn-danger w-100"
             onclick="return confirm('Tem certeza que deseja remover {{ p.nome }}?')">ðŸ—‘ Remover</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-warning">Nenhum produto encontrado.</div>
{% endif %}

<a href="{{ url_for('index') }}" class="btn btn-secondary mt-3">Voltar</a>
{% endblock %}
